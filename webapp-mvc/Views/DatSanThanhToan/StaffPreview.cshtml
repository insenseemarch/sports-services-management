@model webapp_mvc.Models.ThanhToanKhachHangViewModel
@{
    ViewData["Title"] = "Phi·∫øu ƒê·∫∑t S√¢n (N·ªôi b·ªô)";
}

<div class="container py-5 mt-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <!-- Receipt Card -->
            <div class="card border-0 shadow-lg rounded-4 overflow-hidden">
                <!-- Header -->
                <div class="card-header border-0 p-4 text-center text-white" 
                     style="background: linear-gradient(135deg, #059669 0%, #10b981 100%);">
                    <h3 class="fw-bold mb-1 text-uppercase ls-1">üìã Phi·∫øu ƒê·∫∑t S√¢n</h3>
                    <small class="opacity-75">D√†nh cho b·ªô ph·∫≠n L·ªÖ t√¢n & ƒê·∫∑t s√¢n</small>
                </div>

                <div class="card-body p-5 bg-white">
                    <!-- General Info -->
                    <div class="row mb-4 border-bottom pb-4">
                        <div class="col-6">
                            <small class="text-muted fw-bold d-block text-uppercase mb-1">Ng∆∞·ªùi l·∫≠p phi·∫øu</small>
                            <span class="fw-bold text-dark fs-5"><i class="fas fa-user-tie me-2 text-primary"></i>@ViewBag.TenNguoiLap</span>
                        </div>
                        <div class="col-6 text-end">
                            <small class="text-muted fw-bold d-block text-uppercase mb-1">Ng√†y l·∫≠p</small>
                            <span class="fw-bold text-dark"><i class="far fa-clock me-2"></i>@ViewBag.NgayLap</span>
                        </div>
                    </div>

                    <!-- Customer Info -->
                    <div class="alert alert-light border-0 bg-light rounded-3 p-3 mb-4">
                         <h6 class="fw-bold text-dark mb-2"><i class="fas fa-address-card me-2 text-success"></i>Th√¥ng Tin Kh√°ch H√†ng</h6>
                         <div class="d-flex justify-content-between">
                             <span>H·ªç v√† t√™n: <strong class="ms-2">@ViewBag.TenKhachHang</strong></span>
                             <span>SƒêT: <strong class="ms-2">@ViewBag.SDTKhachHang</strong></span>
                         </div>
                    </div>

                    <!-- Court Details -->
                    <div class="mb-4">
                        <h6 class="fw-bold text-secondary text-uppercase small ls-1 mb-3">Chi ti·∫øt ƒë·∫∑t s√¢n</h6>
                        <div class="table-responsive">
                            <table class="table table-borderless bg-light rounded-3 overflow-hidden mb-0">
                                <thead class="bg-secondary bg-opacity-10 text-secondary">
                                    <tr>
                                        <th class="ps-3">S√¢n / C∆° s·ªü</th>
                                        <th class="text-center">Th·ªùi gian</th>
                                        <th class="text-center">S·ªë l∆∞·ª£ng</th>
                                        <th class="text-end pe-3">Th√†nh ti·ªÅn</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td class="ps-3 align-middle">
                                            <div class="fw-bold text-dark">@Model.TenSan</div>
                                            <small class="text-muted">@Model.TenCoSo</small>
                                        </td>
                                        <td class="text-center align-middle">
                                            <div class="small fw-bold">@Model.NgayDat.ToString("dd/MM/yyyy")</div>
                                            <small class="text-muted">@Model.GioBatDau.ToString(@"hh\:mm") - @Model.GioKetThuc.ToString(@"hh\:mm")</small>
                                        </td>
                                        <td class="text-center align-middle">
                                            <span class="badge bg-white text-dark border shadow-sm px-3">
                                                @Model.SoLuongSan.ToString("0.##") @Model.DonViTinh
                                            </span>
                                        </td>
                                        <td class="text-end pe-3 align-middle fw-bold text-dark">
                                            @Model.TienSan.ToString("N0") ‚Ç´
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Services Details -->
                    @if (Model.DanhSachDichVu != null && Model.DanhSachDichVu.Count > 0)
                    {
                        <div class="mb-4">
                            <h6 class="fw-bold text-secondary text-uppercase small ls-1 mb-3">D·ªãch v·ª• ƒëi k√®m</h6>
                            <div class="table-responsive">
                                <table class="table table-sm table-borderless">
                                    <thead class="text-muted small border-bottom">
                                        <tr>
                                            <th>T√™n d·ªãch v·ª•</th>
                                            <th class="text-center">S·ªë l∆∞·ª£ng</th>
                                            <th class="text-end">Ti·ªÅn</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var item in Model.DanhSachDichVu)
                                        {
                                            <tr>
                                                <td class="py-2">@item.TenDV</td>
                                                <td class="text-center py-2">x @item.SoLuong</td>
                                                <td class="text-end py-2 fw-semibold">@item.ThanhTien.ToString("N0") ‚Ç´</td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    }

                    <div class="border-top border-2 border-dashed my-4"></div>

                    <!-- Totals -->
                    <div class="row justify-content-end">
                        <div class="col-md-6">
                            <div class="d-flex justify-content-between mb-2">
                                <span class="text-muted">T·ªïng ti·ªÅn s√¢n:</span>
                                <span class="fw-bold">@Model.TienSan.ToString("N0") ‚Ç´</span>
                            </div>
                            <div class="d-flex justify-content-between mb-2">
                                <span class="text-muted">T·ªïng d·ªãch v·ª•:</span>
                                <span class="fw-bold">@Model.TienDichVu.ToString("N0") ‚Ç´</span>
                            </div>
                            <!-- C√≥ th·ªÉ th√™m d√≤ng Gi·∫£m Gi√° / ∆Øu ƒê√£i ·ªü ƒë√¢y n·∫øu c·∫ßn -->
                            <div class="d-flex justify-content-between mt-3 pt-3 border-top">
                                <span class="fs-5 fw-bold text-dark text-uppercase">Ph·∫£i Thanh To√°n:</span>
                                <span class="fs-4 fw-bolder text-danger">@Model.ThanhTien.ToString("N0") ‚Ç´</span>
                            </div>
                        </div>
                    </div>

                </div>
                
                <!-- Footer Buttons -->
                <div class="card-footer bg-light p-4 d-flex justify-content-center gap-3 border-0">
                    <button type="button" class="btn px-5 py-3 fw-bold rounded-pill shadow-sm flex-fill" 
                            style="background: linear-gradient(135deg, #059669 0%, #10b981 100%); color: white; border: none;"
                            onclick="submitAction('send_cashier')">
                        <i class="fas fa-share-square me-2"></i>CHUY·ªÇN SANG NV THU NG√ÇN
                    </button>
                    
                    <a asp-action="Index" asp-controller="DatSan" 
                       class="btn px-5 py-3 fw-bold rounded-pill text-decoration-none flex-fill"
                       style="background: transparent; border: 2px solid #059669; color: #059669;">
                        <i class="fas fa-arrow-left me-2"></i>Quay l·∫°i trang ƒë·∫∑t s√¢n
                    </a>
                </div>
            </div>
            
        </div>
    </div>
</div>

<script>
    function showToast(message, type = 'success') {
        // Create toast element
        const toast = document.createElement('div');
        toast.className = 'custom-toast';
        toast.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: ${type === 'success' ? 'linear-gradient(135deg, #059669 0%, #10b981 100%)' : 'linear-gradient(135deg, #dc2626 0%, #ef4444 100%)'};
            color: white;
            padding: 16px 24px;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            z-index: 9999;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideIn 0.3s ease-out;
            max-width: 400px;
        `;
        
        const icon = type === 'success' ? '‚úì' : '‚úï';
        toast.innerHTML = `
            <span style="font-size: 24px; background: rgba(255,255,255,0.2); width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center;">${icon}</span>
            <span>${message}</span>
        `;
        
        document.body.appendChild(toast);
        
        // Auto remove after 3 seconds
        setTimeout(() => {
            toast.style.animation = 'slideOut 0.3s ease-in';
            setTimeout(() => toast.remove(), 300);
        }, 3000);
    }
    
    function submitAction(type) {
        // Show loading or disable buttons...
        const btn = event.target;
        btn.disabled = true;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>ƒêang x·ª≠ l√Ω...';
        
        $.post('@Url.Action("StaffAction", "DatSanThanhToan")', { 
            maDatSan: @Model.MaDatSan, 
            actionType: type 
        }, function(response) {
            if (response.success) {
                showToast(response.message, 'success');
                setTimeout(() => {
                    if (response.redirectUrl) window.location.href = response.redirectUrl;
                }, 1500);
            } else {
                showToast("L·ªói: " + response.message, 'error');
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-share-square me-2"></i>CHUY·ªÇN SANG NV THU NG√ÇN';
            }
        }).fail(function() {
            showToast("L·ªói k·∫øt n·ªëi m√°y ch·ªß!", 'error');
            btn.disabled = false;
            btn.innerHTML = '<i class="fas fa-share-square me-2"></i>CHUY·ªÇN SANG NV THU NG√ÇN';
        });
    }
</script>

<style>
    .ls-1 { letter-spacing: 1px; }
    .hover-underline:hover { text-decoration: underline !important; }
    
    @@keyframes slideIn {
        from {
            transform: translateX(400px);
            opacity: 0;
        }
        to {
            transform: translateX(0);
            opacity: 1;
        }
    }
    
    @@keyframes slideOut {
        from {
            transform: translateX(0);
            opacity: 1;
        }
        to {
            transform: translateX(400px);
            opacity: 0;
        }
    }
</style>
