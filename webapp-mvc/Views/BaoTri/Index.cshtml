@{
    ViewData["Title"] = "Bảo Trì Sân";
}

<div class="position-relative w-100 d-flex align-items-center justify-content-center mb-5" 
     style="height: 350px; background: linear-gradient(135deg, #20bf55 0%, #01baef 100%); padding-top: 85px;">
    <div class="position-absolute top-0 start-0 w-100 h-100" style="background: rgba(0,0,0,0.2);"></div>
    
    <div class="text-center position-relative" style="z-index: 2;">
        <h1 class="display-3 fw-bold text-white mb-3">
            <i class="fas fa-tools me-3"></i>BẢO TRÌ SÂN
        </h1>
        <p class="lead text-light fs-5">Danh sách phiếu bảo trì được giao cho bạn</p>
    </div>
</div>

<div class="container pb-5">
    <div class="row">
        <div class="col-12">

            @if (ViewBag.DanhSachPhieu != null && ViewBag.DanhSachPhieu.Rows.Count > 0)
            {
                <div class="row g-4">
                    @foreach (System.Data.DataRow row in ViewBag.DanhSachPhieu.Rows)
                    {
                        var trangThai = row["TrangThai"].ToString();
                        var badgeClass = trangThai == "Đang xử lý" ? "bg-warning text-dark" : 
                                        trangThai == "Hoàn thành" ? "bg-success" : 
                                        trangThai == "Chờ xử lý" ? "bg-secondary" : "bg-info";
                        
                        <div class="col-md-6 col-lg-4">
                            <div class="card border-0 shadow hover-elevate h-100 overflow-hidden" style="border-radius: 20px;">
                                <!-- Header -->
                                <div class="card-header py-3 border-0 d-flex align-items-center" 
                                     style="background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); color: #065f46; padding-left: 20px;">
                                    <i class="fas fa-wrench fa-lg me-2"></i>
                                    <h5 class="mb-0 fw-bold">Phiếu #@row["MaPhieu"]</h5>
                                </div>
                                
                                <div class="card-body p-4 bg-white">
                                    <!-- Status Badge -->
                                    <div class="mb-4">
                                        <span class="badge @badgeClass rounded-pill px-3 py-2" style="font-size: 0.9rem;">@trangThai</span>
                                    </div>
                                    
                                    <!-- Info List -->
                                    <div class="vstack gap-3">
                                        <!-- Sân -->
                                        <div class="d-flex align-items-center">
                                            <div class="icon-box bg-primary text-white shadow-sm">
                                                <i class="fas fa-basketball-ball"></i>
                                            </div>
                                            <div>
                                                <small class="text-muted d-block lh-1">Sân</small>
                                                <span class="fw-bold fs-5 text-dark">@row["MaSan"]</span>
                                            </div>
                                        </div>

                                        <!-- Loại -->
                                        <div class="d-flex align-items-center">
                                            <div class="icon-box text-white shadow-sm" style="background: #06d6a0;">
                                                <i class="fas fa-layer-group"></i>
                                            </div>
                                            <div>
                                                <small class="text-muted d-block lh-1">Loại</small>
                                                <span class="fw-bold text-dark">@row["TenLS"]</span>
                                            </div>
                                        </div>

                                        <!-- Cơ sở -->
                                        <div class="d-flex align-items-center">
                                            <div class="icon-box text-white shadow-sm" style="background: #2ec4b6;">
                                                <i class="fas fa-building"></i>
                                            </div>
                                            <div>
                                                <small class="text-muted d-block lh-1">Cơ sở</small>
                                                <span class="fw-bold text-dark">@row["TenCS"]</span>
                                            </div>
                                        </div>

                                        <!-- Ngày bắt đầu -->
                                        <div class="d-flex align-items-center">
                                            <div class="icon-box text-white shadow-sm" style="background: #fb8500;">
                                                <i class="fas fa-calendar-alt"></i>
                                            </div>
                                            <div>
                                                <small class="text-muted d-block lh-1">Bắt đầu</small>
                                                <span class="fw-bold text-dark">@Convert.ToDateTime(row["NgayBatDau"]).ToString("dd/MM/yyyy")</span>
                                            </div>
                                        </div>

                                        <!-- KT Dự kiến -->
                                        <div class="d-flex align-items-center">
                                            <div class="icon-box text-white shadow-sm" style="background: #9d4edd;">
                                                <i class="fas fa-calendar-check"></i>
                                            </div>
                                            <div>
                                                <small class="text-muted d-block lh-1">KT dự kiến</small>
                                                <span class="fw-bold text-dark">
                                                    @if (row["NgayKetThucDuKien"] != DBNull.Value)
                                                    {
                                                        @Convert.ToDateTime(row["NgayKetThucDuKien"]).ToString("dd/MM/yyyy")
                                                    }
                                                    else
                                                    {
                                                        <span class="text-muted">---</span>
                                                    }
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Sự cố Box -->
                                    <div class="mt-4 p-3 rounded-3" style="background: #fff3cd; border-left: 5px solid #ffc107;">
                                        <div class="d-flex">
                                            <i class="fas fa-exclamation-triangle text-warning me-2 mt-1"></i>
                                            <div>
                                                <small class="text-secondary fw-bold text-uppercase" style="font-size: 0.7rem;">Sự cố</small>
                                                <div class="text-dark fw-medium">
                                                    @(row["MoTaSuCo"] != DBNull.Value && !string.IsNullOrEmpty(row["MoTaSuCo"].ToString()) 
                                                        ? row["MoTaSuCo"].ToString() 
                                                        : "Không có mô tả")
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Chi Phí Box -->
                                    <div class="mt-4 p-3 text-center rounded-3 position-relative" 
                                         style="background: #fee2e2; border: 2px dashed #ef4444;">
                                        <small class="text-secondary fw-bold text-uppercase" style="font-size: 0.75rem;">Chi Phí Bảo Trì</small>
                                        <div class="d-flex justify-content-center align-items-center mt-1">
                                            <i class="fas fa-coins text-danger me-2 fa-lg"></i>
                                            <h3 class="mb-0 fw-bold text-danger">
                                                @(row["ChiPhi"] != DBNull.Value ? Convert.ToDecimal(row["ChiPhi"]).ToString("N0") : "0") ₫
                                            </h3>
                                        </div>
                                    </div>
                                </div>

                                <!-- Footer -->
                                <div class="card-footer border-0 py-3 text-center" style="background: #e6fffa;">
                                    <a asp-action="CapNhat" asp-controller="BaoTri" 
                                       asp-route-maPhieu="@row["MaPhieu"]"
                                       class="btn btn-success rounded-pill px-4 fw-bold shadow-sm"
                                       style="background: #065f46; border: none;">
                                        <i class="fas fa-edit me-2"></i>Cập nhật
                                    </a>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            }
            else
            {
                <div class="card border-0 shadow-sm rounded-4">
                    <div class="card-body text-center py-5">
                        <i class="fas fa-tools fa-4x text-muted mb-3"></i>
                        <h5 class="text-muted">Chưa có phiếu bảo trì nào</h5>
                        <p class="text-muted mb-0">Bạn chưa được giao phiếu bảo trì nào.</p>
                    </div>
                </div>
            }
        </div>
    </div>
</div>

<style>
    .hover-elevate:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 30px rgba(0,0,0,0.15) !important;
    }
    
    .icon-box {
        width: 45px;
        height: 45px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 15px;
        font-size: 1.2rem;
        flex-shrink: 0;
    }
</style>
