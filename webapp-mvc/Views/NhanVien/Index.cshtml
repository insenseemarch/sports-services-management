@{
    ViewData["Title"] = "Phi·∫øu ƒê·∫∑t S√¢n - Nh√¢n Vi√™n";
}

<!-- Background Layer -->
<div class="position-fixed top-0 start-0 w-100 h-100" style="z-index: -1; background: #f0fdf4;"></div>

<div class="container py-5 mt-5">
    <div class="row">
        <div class="col-12">
            <!-- Header -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 class="fw-bold mb-0" style="color: #065f46;">üìã Phi·∫øu ƒê·∫∑t S√¢n</h2>
                <a asp-action="Index" asp-controller="DatSan" class="btn btn-success px-4 py-2 rounded-pill">
                    <i class="fas fa-plus me-2"></i>T·∫°o Phi·∫øu M·ªõi
                </a>
            </div>

            <!-- Filter Section -->
            <div class="card border-0 shadow-sm rounded-4 mb-4">
                <div class="card-body p-4">
                    <form method="get" asp-action="Index" asp-controller="NhanVien" id="filterForm">
                        <div class="row g-3 align-items-end">
                            <div class="col-md-3">
                                <label class="form-label fw-semibold small" style="color: #065f46;">T·ª´ ng√†y</label>
                                <input type="date" name="fromDate" class="form-control" value="@ViewBag.FromDate" />
                            </div>
                            <div class="col-md-3">
                                <label class="form-label fw-semibold small" style="color: #065f46;">ƒê·∫øn ng√†y</label>
                                <input type="date" name="toDate" class="form-control" value="@ViewBag.ToDate" />
                            </div>
                            <div class="col-md-3">
                                <label class="form-label fw-semibold small" style="color: #065f46;">Tr·∫°ng th√°i</label>
                                <select name="status" class="form-select">
                                    <option value="">T·∫•t c·∫£</option>
                                    <option value="Ch·ªù thanh to√°n" selected="@(ViewBag.Status == "Ch·ªù thanh to√°n" ? "selected" : null)">Ch·ªù thanh to√°n</option>
                                    <option value="ƒê√£ thanh to√°n" selected="@(ViewBag.Status == "ƒê√£ thanh to√°n" ? "selected" : null)">ƒê√£ thanh to√°n</option>
                                    <option value="ƒê√£ h·ªßy" selected="@(ViewBag.Status == "ƒê√£ h·ªßy" ? "selected" : null)">ƒê√£ h·ªßy</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <button type="submit" class="btn btn-success w-100 rounded-pill">
                                    <i class="fas fa-filter me-2"></i>L·ªçc
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            @if (ViewBag.SuccessMessage != null)
            {
                <div class="alert alert-success alert-dismissible fade show rounded-3" role="alert">
                    <i class="fas fa-check-circle me-2"></i>@ViewBag.SuccessMessage
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            }

            @if (ViewBag.DanhSachPhieu != null && ViewBag.DanhSachPhieu.Rows.Count > 0)
            {
                <div class="card border-0 shadow-sm rounded-4">
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-hover mb-0">
                                <thead style="background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); color: #065f46;">
                                    <tr>
                                        <th class="ps-4 py-3">M√£ Phi·∫øu</th>
                                        <th>Kh√°ch H√†ng</th>
                                        <th>S√¢n</th>
                                        <th>Ng√†y ƒê·∫∑t</th>
                                        <th>Gi·ªù</th>
                                        <th>Ti·ªÅn S√¢n</th>
                                        <th>Tr·∫°ng Th√°i</th>
                                        <th class="text-center pe-4">Thao T√°c</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (System.Data.DataRow row in ViewBag.DanhSachPhieu.Rows)
                                    {
                                        var trangThai = row["TrangThai"].ToString();
                                        var badgeClass = trangThai == "Ch·ªù thanh to√°n" ? "bg-warning text-dark" : 
                                                        trangThai == "ƒê√£ thanh to√°n" ? "bg-success" : 
                                                        trangThai == "ƒê√£ h·ªßy" ? "bg-danger" : "bg-secondary";
                                        
                                        <tr>
                                            <td class="ps-4 py-3 fw-bold">#@row["MaDatSan"]</td>
                                            <td>
                                                <div class="fw-semibold">@row["TenKhachHang"]</div>
                                                <small class="text-muted">@row["SDT"]</small>
                                            </td>
                                            <td>
                                                <div>@(row["TenLS"] + " - " + row["MaSan"])</div>
                                                <small class="text-muted">@row["TenCS"]</small>
                                            </td>
                                            <td>@Convert.ToDateTime(row["NgayDat"]).ToString("dd/MM/yyyy")</td>
                                            <td>
                                                @(((TimeSpan)row["GioBatDau"]).ToString(@"hh\:mm") + " - " + ((TimeSpan)row["GioKetThuc"]).ToString(@"hh\:mm"))
                                            </td>
                                            <td class="fw-bold text-success">
                                                @(row["TienSan"] != DBNull.Value ? Convert.ToDecimal(row["TienSan"]).ToString("N0") : "0") ‚Ç´
                                            </td>
                                            <td>
                                                <span class="badge @badgeClass rounded-pill px-3">@trangThai</span>
                                            </td>
                                            <td class="text-center pe-4">
                                                <a asp-action="StaffPreview" asp-controller="DatSanThanhToan" 
                                                   asp-route-maDatSan="@row["MaDatSan"]"
                                                   class="btn btn-sm btn-outline-success rounded-pill px-3">
                                                    <i class="fas fa-eye me-1"></i>Xem
                                                </a>
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            }
            else
            {
                <div class="text-center py-5">
                    <i class="fas fa-inbox fa-4x text-muted mb-3"></i>
                    <h5 class="text-muted">Ch∆∞a c√≥ phi·∫øu ƒë·∫∑t s√¢n n√†o</h5>
                    <p class="text-muted">H√£y t·∫°o phi·∫øu ƒë·∫∑t s√¢n ƒë·∫ßu ti√™n c·ªßa b·∫°n!</p>
                    <a asp-action="Index" asp-controller="DatSan" class="btn btn-success px-4 py-2 rounded-pill mt-2">
                        <i class="fas fa-plus me-2"></i>T·∫°o Phi·∫øu M·ªõi
                    </a>
                </div>
            }
        </div>
    </div>
</div>
